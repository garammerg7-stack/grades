<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بوابة المدرس - رصد الدرجات</title>
    <link rel="stylesheet" href="style.css?v=1.8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
</head>

<body>

    <!-- Login Section -->
    <section id="login-section" class="glass">
        <div class="logo-icon">
            <i class="fa-solid fa-graduation-cap"></i>
        </div>

        <div class="login-tabs">
            <button class="tab-btn active" data-role="teacher">مدرس</button>
            <button class="tab-btn" data-role="student">طالب</button>
        </div>

        <h1 id="login-title">مرحبًا بكم<br>نظام الاستعلام عن درجات الطالب</h1>
        <p class="subtitle" id="login-subtitle">سجل دخولك كـ مدرس للمتابعة</p>

        <form id="login-form">
            <!-- Student Course Selection Removed for Privacy -->

            <div class="input-group" id="username-group">
                <label for="username" id="username-label">البريد الإلكتروني</label>
                <input type="text" id="username" placeholder="example@mail.com">
            </div>

            <!-- Student Name Selection (Searchable) -->
            <div class="input-group" id="student-name-group" style="display: none;">
                <label for="student-name" id="student-name-label">الاسم</label>
                <input type="text" id="student-name" list="student-names-list" placeholder="ابدأ بكتابة اسمك..."
                    autocomplete="off">
                <datalist id="student-names-list"></datalist>
            </div>

            <div class="input-group" id="password-group">
                <label for="password" id="password-label">كلمة المرور</label>
                <input type="password" id="password" placeholder="••••••••">
            </div>

            <div id="error-msg" class="error-message"></div>

            <button type="submit" class="btn-primary">
                تسجيل الدخول <i class="fa-solid fa-arrow-left"></i>
            </button>
            <p class="disclaimer-note">هذا النظام خاص بأستاذ المقرر ولايتبع أي جهة رسمية</p>
        </form>

        <div class="theme-switcher-container"
            style="margin-top: 2rem; border-top: 1px solid var(--glass-border); padding-top: 1.5rem;">
            <p style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.5rem;">اختر المظهر:</p>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button class="theme-opt-btn theme-original active" onclick="setTheme('original')"
                    title="أصلي"></button>
                <button class="theme-opt-btn theme-grey" onclick="setTheme('grey')" title="رمادي"></button>
                <button class="theme-opt-btn theme-blue" onclick="setTheme('blue')" title="أزرق"></button>
            </div>
        </div>
    </section>

    <!-- Dashboard Section -->
    <section id="dashboard-section" class="glass">
        <!-- New Top Navigation -->
        <nav class="main-nav">
            <div class="header-top">
                <div class="nav-brand">
                    <div class="avatar">T</div>
                    <div>
                        <h3 id="current-user">Teacher</h3>
                        <span id="user-role-badge">Admin</span>
                    </div>
                </div>

                <div class="header-actions">
                    <div class="theme-switcher-container">
                        <button class="theme-opt-btn theme-original active" onclick="setTheme('original')"
                            title="أصلي"></button>
                        <button class="theme-opt-btn theme-grey" onclick="setTheme('grey')" title="رمادي"></button>
                        <button class="theme-opt-btn theme-blue" onclick="setTheme('blue')" title="أزرق"></button>
                    </div>

                    <button id="logout-btn" class="logout-btn">
                        <i class="fa-solid fa-right-from-bracket"></i> خروج
                    </button>
                </div>
            </div>

            <div class="nav-links">
                <button class="nav-btn active" data-tab="grades">
                    <i class="fa-solid fa-graduation-cap"></i> الدرجات
                </button>
                <button class="nav-btn" data-tab="attendance">
                    <i class="fa-solid fa-calendar-check"></i> الحضور
                </button>
                <button class="nav-btn" data-tab="files">
                    <i class="fa-solid fa-folder-open"></i> الملفات
                </button>
                <button class="nav-btn" data-tab="exams">
                    <i class="fa-solid fa-graduation-cap"></i> الامتحانات
                </button>
                <button class="nav-btn" data-tab="announcements">
                    <i class="fa-solid fa-bullhorn"></i> الإعلانات
                </button>
                <button class="nav-btn" data-tab="settings" id="nav-settings-btn">
                    <i class="fa-solid fa-gears"></i> الإدارة
                </button>
            </div>
        </nav>

        <!-- Course Selector (Global) -->
        <div class="course-controls">
            <div class="course-select-wrapper">
                <label><i class="fa-solid fa-book"></i> المقرر الحالي:</label>
                <select id="course-select">
                    <!-- Dynamic -->
                </select>
            </div>
        </div>

        <!-- content-area for ACTIONS (Upload, Print) that change per tab -->
        <div id="action-bar" class="action-bar">
            <!-- Injected by JS based on active tab -->
        </div>


        <div id="student-announcements-bar" style="display: none;">
            <!-- Injected by JS -->
        </div>

        <div class="table-container" id="grades-container">
            <table>
                <thead>
                    <tr>
                        <th>اسم الطالب</th>
                        <th>أعمال الفصل (40)</th>
                        <th>الامتحان النهائي (60)</th>
                        <th>المجموع (100)</th>
                        <th id="th-controls" style="display: none;">تحكم</th>
                    </tr>
                </thead>
                <tbody id="grades-body">
                    <!-- Rows will be injected by JS -->
                </tbody>
            </table>
        </div>

        <div class="table-container" id="attendance-container" style="display: none;">
            <div class="attendance-legend">
                <div class="legend-item"><span class="att-icon att-present">✔️</span> حاضر</div>
                <div class="legend-item"><span class="att-icon att-absent">❌</span> غائب دون عذر</div>
                <div class="legend-item"><span class="att-icon att-excused">م</span> غائب بعذر</div>
                <div class="legend-item"><span class="att-icon att-undefined">N</span> غير معرف</div>
            </div>
            <table class="attendance-table">
                <thead id="attendance-head">
                    <!-- Dynamic Headers (Sessions 1-14) -->
                </thead>
                <tbody id="attendance-body">
                    <!-- Rows will be injected by JS -->
                </tbody>
            </table>
        </div>

        <!-- Files View -->
        <div id="files-container" class="settings-view" style="display: none;">
            <!-- Injected by JS -->
        </div>

        <!-- Exams View -->
        <div id="exams-container" class="settings-view" style="display: none;">
            <!-- Injected by JS -->
        </div>

        <!-- Announcements View -->
        <div id="announcements-container" class="settings-view" style="display: none;">
            <!-- Injected by JS -->
        </div>

        <!-- Settings Dashboard View -->
        <div id="settings-container" class="settings-view" style="display: none;">

            <div class="settings-section">
                <h3><i class="fa-solid fa-user-lock"></i> إدارة كلمات المرور</h3>
                <div class="settings-info-card">
                    <p>يمكنك تصفير كلمات مرور جميع الطلاب في المقرر الحالي بضغطة زر واحدة.</p>
                    <p>لتصفير كلمة مرور طالب محدد، اذهب إلى قائمة "الدرجات" واستخدم أيقونة القفل بجانب اسم الطالب.</p>
                </div>
                <button id="reset-bulk-btn" class="upload-btn" onclick="resetAllCoursePasswords()"
                    style="background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); margin-top: 1rem; width: 100%;">
                    <i class="fa-solid fa-user-lock"></i> تصفير كلمات السر للجميع
                </button>
                <button id="set-unified-btn" class="upload-btn" onclick="setAllCoursePasswordsToValue()"
                    style="background: rgba(59, 130, 246, 0.2); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.3); margin-top: 0.5rem; width: 100%;">
                    <i class="fa-solid fa-key"></i> تعيين بكلمة مرور موحدة
                </button>
            </div>

            <div class="settings-section">
                <h3><i class="fa-solid fa-layer-group"></i> إدارة المقررات</h3>

                <div style="display: flex; gap: 10px; margin-bottom: 1.5rem;">
                    <input type="text" id="settings-new-course" placeholder="اسم المقرر الجديد" style="flex: 1;">
                    <button onclick="addNewCourseFromSettings()" class="btn-primary"
                        style="width: auto; padding: 0 2rem; white-space: nowrap;">إضافة</button>
                </div>

                <div id="settings-course-list" class="course-grid">
                    <!-- Course items injected by JS -->
                </div>
            </div>
        </div>

        <!-- Statistics View -->
        <div id="stats-container" class="settings-view" style="display: none;">
            <div class="settings-section">
                <h3><i class="fa-solid fa-chart-line"></i> الإحصائيات العامة</h3>
                <div class="stats-grid">
                    <div class="stats-card">
                        <i class="fa-solid fa-users-viewfinder"></i>
                        <h4>عدد زيارات الطلاب</h4>
                        <div id="student-visits-count" class="count">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Manage Courses Modal -->
    </section>

    <!-- Hidden Inputs for Uploads -->
    <input type="file" id="grades-upload" accept=".xlsx, .xls" style="display: none;">
    <input type="file" id="attendance-upload" accept=".xlsx, .xls" style="display: none;">
    <input type="file" id="file-upload" style="display: none;" accept=".pdf, .doc, .docx, .ppt, .pptx">

    <script src="script.js"></script>
</body>

</html>